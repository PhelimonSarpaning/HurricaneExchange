{% extends 'base.html' %}

{% block content %}
    {% if firstTime %}
    <h3>Setup Progress</h3>
    <div class="progress" style="height: 40px;">
        <div class="progress-bar" role="progressbar" style="width: 70%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">70%</div>
    </div>
    <br>
    {% endif %}
<div>
  <a class="link dropdown-toggle btn btn-sm btn-primary" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Accounts</a>
  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
  {% if defaultAccount %}
    <a class="dropdown-item" href="/trading/{{ defaultAccount.id }}"><i class="fa fa-users fa-fw"></i> {{ defaultAccount.trading_name }}</a>
  {% endif %}
  {% for instance in list_accounts %}
    {% if instance.id != defaultAccount.id %}
      <a class="dropdown-item" href="/trading/{{ instance.id }}"><i class="fa fa-users fa-fw"></i> {{ instance.trading_name }}</a>
    {% endif %}
  {% endfor %}
  <div class="dropdown-divider"></div>
	<a class="dropdown-item" href="/trading/create"><i class="fa fa-cog fa-fw"></i> Open a new trading account</a>
</div>
  <a class="btn btn-sm btn-primary" href="/trading" role="button" aria-haspopup="true" aria-expanded="false">View All</a>
    {% if firstTime %}
        <div class='row text-center justify-content-md-center'>
            <div class'col-sm-12'>
                <div class='card'>
                    <div class='card-body'>
                        <h3 class='card-title'>Purchase your first share</h3>
                        <h5>This is where you can view your account information</h5>
                        <h5>From here, we can purchase your first shares</h5>
                        <h5>Click the buy shares button to begin buying shares</h5>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
<div class='row text-center'>
  <div class='col-sm-12'>
    <h1>Trading Account: {{ trading_account.trading_name }}</h1>
    <h2>Shares in your trading account </h2>
  </div>
</div>


<!-- View Trading Accounts -->
<h3>{{ no_stock }}</h3>

<table class="table table-striped">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Stock</th>
      <th scope="col">Number of Shares</th>
      <th scope="col">Value (per share)</th>
      <th scope="col">Daily Change</th>
      <th> Total Value</th>
      <th scope="col"></th>
      <th></th>

    </tr>
  </thead>
  <tr>
    {% for shares in sharesObj %}
       <tr>
          <th> <a href="/stock/buy/{{ shares.stockID.stock_ticker }}/">{{ shares.stockID.stock_name }}</a> </th>
          <th> {{shares.shares_amount}} </th>
          <th> {{shares.stockID.stock_price}} </th>
          <th>{% if shares.stockID.stock_dayChange > 0 %}
              <div style="color:green">{{shares.stockID.stock_dayChange}}<i class="material-icons" style ="vertical-align:middle;">arrow_drop_up</i></div>
          {% elif shares.stockID.stock_dayChange < 0 %}
              <div style="color:red">{{shares.stockID.stock_dayChange}}<i class="material-icons" style ="vertical-align:middle;">arrow_drop_down</i></div>
          {% else %}
              <div style="color:green">{{shares.stockID.stock_dayChange}}</div>
          {% endif %}
          </th>
          {% for total in share_value %}
            {% for key, value in total.items %}
                {% if key == shares.stockID.stock_ticker %}
                <th> {{value|floatformat:2}}  </th>
                {% endif %}
              {% endfor %}
          {% endfor %}
          <td></td>
           <th> <button onclick="window.location.href='/stock/{{trading_account.id}}/sell/{{shares.stockID.stock_ticker}}'" class= "btn-secondary btn-sm">Sell</button> </th>
       </tr>
    {% endfor %}
  </table>

<form action="/stock/stocklist">
  {% if firstTime %}
    <button class ="btn btn-danger" type="submit">Buy Shares</button>
  {% else %}
    <button class ="btn btn-secondary btn-sm" type="submit">Buy Shares</button>
  {% endif %}
</form>

<br>

{% if trading_account.is_default != True %}
  <form action="." method='POST'>
    {% csrf_token %}
    <button class ="btn btn-secondary btn-sm" type="submit">Make this my default trading account</button>
  </form>
  <br>

{% endif %}

<form action="/trading/delete/{{ trading_account.id }}">
    <button class ="btn btn-secondary btn-sm" type="submit">Close this trading account</button>
</form>

{% endblock %}
