{% extends 'base.html' %}
{% block content %}
<button onclick="goBack()" class = 'btn-sm btn-secondary'>Go Back</button>
<h1>Confirm purchase of stock: {{ stock_name}}</h1>
 Available shares: {{stock_available}}<br>
 Price (per share): {{stock_price}}<br>

 <form method='POST'>{% csrf_token %}

 Quantity to purchase (between 1 and {{stock_available}}):
 {{form.shares_amount}} <br>
 Select trading account:
    <select name = "selectedAccount">
      {%for account in trading_accounts%}
        <option value="{{account.pk}}">{{account.trading_name}}</option>
      {% endfor %}
    </select> <br>
    Total:<input type="text" id="total" value="$0.00" readonly> <br>
<button onclick="submit" class="btn btn-primary btn">Buy</button>
</form>

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
        {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %} Sorry! {% endif %}
        {{ message }}
    </li>
    {% endfor %}
</ul>
{% endif %}

<div id="container" style="height: 400px; min-width: 310px"></div>

<script src="https://code.highcharts.com/stock/highstock.js"></script>
{{ historical|json_script:"historicalData"}}

<script type="text/javascript">
  // Create the chart
  document.getElementById("id_shares_amount").max = {{stock_available}}

  var value = JSON.parse(document.getElementById('historicalData').textContent);

  Highcharts.stockChart('container', {
        rangeSelector: {
            selected: 1
        },
        title: {
            text: "{{stock_ticker}}"
        },
      series:  [{
            data: value,
            tooltip: {
                valueDecimals: 3
            },
            turboThreshold: 0
        }],
    });


    function updateTotal(){
      var amount = document.getElementById("id_shares_amount").value
      if(amount >= 0){
        document.getElementById("total").value = "$" + {{stock_price}} * amount;
      }
  }

  updateTotal();

  function goBack() {
    window.history.back()
  }

</script>

{% endblock %}
