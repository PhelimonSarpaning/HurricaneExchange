{% extends 'base.html' %}
{% block content %}
<div class ='mb-2'>
<button onclick="goBack()" class = 'btn-sm btn-secondary'>Go Back</button>
</div>
<div class ='card'>
<div class='card-body'>
  <span class ='card-title display-4'>{{stock_name}} <button onclick="" class = 'btn btn-primary' style='vertical-align: middle'>BUY</button></span>
  <hr>
   <!-- <div class= 'col-3' style='min-width: 380px;'> -->
     <h5>
       Available shares: {{stock_available}}<br>
       Price: ${{stock_price}} <sub>AUD</sub><br>
       Day Change:{% if stock_dayChange > 0 %}
       <a style="color:green">{{stock_dayChange}} ({{stock_dayChangePercent}})<i class="material-icons" style ="vertical-align:middle;">arrow_drop_up</i></a>
   {% elif stock_dayChange < 0 %}
       <a style="color:red">{{stock_dayChange}} ({{stock_dayChangePercent}})<i class="material-icons" style ="vertical-align:middle;">arrow_drop_down</i></a>
   {% else %}
       <a style="color:green">{{stock_dayChange}} ({{stock_dayChangePercent}})</a>
   {% endif %}</h5>


  <!-- <div class= 'col'style='min-width: 380px;'> -->
    <div id="container"></div>
  </div>
</div>


<form method='POST'>{% csrf_token %}
  Select trading account:
     <select class = 'custom-select' name = "selectedAccount">
       {% if default_trading %}
         <option value="{{default_trading.pk}}">{{default_trading.trading_name}}</option>
       {% endif %}
       {% for account in trading_accounts %}
         {% if account.pk != default_trading.pk %}
           <option value="{{account.pk}}">{{account.trading_name}}</option>
         {% endif %}
       {% endfor %}
     </select> <br>
Quantity to purchase (between 1 and {{stock_available}}):{{form.shares_amount}}
Total:<input class = 'form-control' type="text" id="total" value="$0.00" readonly> <br>
<button onclick="submit" class="btn btn-primary btn">Buy</button>
</form>
{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
        {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %} Sorry! {% endif %}
        {{ message }}
    </li>
    {% endfor %}
</ul>
{% endif %}

<script src="https://code.highcharts.com/stock/highstock.js"></script>
{{ historical|json_script:"historicalData"}}

<script type="text/javascript">
  // Create the chart
  document.getElementById("id_shares_amount").max = {{stock_available}}

  var value = JSON.parse(document.getElementById('historicalData').textContent);

  Highcharts.stockChart('container', {
        rangeSelector: {
            selected: 1
        },
        title: {
            text: ""
        },
      series:  [{
            data: value,
            tooltip: {
                valueDecimals: 3
            },
            turboThreshold: 0
        }],
    });


    function updateTotal(){
      var amount = document.getElementById("id_shares_amount").value
      if(amount >= 0){
        var total = {{stock_price}} * amount
        document.getElementById("total").value = "$" + total.toFixed(2);
      }
  }

  updateTotal();

  function goBack() {
    window.history.back()
  }

</script>

{% endblock %}
